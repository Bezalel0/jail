-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RayCast = require(ReplicatedStorage.Module.RayCast)
local LocalPlayer = Players.LocalPlayer

-- Define ESP functionality
local function createESP(player)
    -- Create ESP Box
    local espBox = Instance.new("BoxHandleAdornment")
    espBox.Adornee = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    espBox.Size = Vector3.new(2, 5, 2) -- Customize the size as needed
    espBox.Color3 = (player.Team.Name == "Police") and Color3.fromRGB(0, 0, 255) or
                    (player.Team.Name == "Criminals") and Color3.fromRGB(255, 0, 0) or
                    (player.Team.Name == "Prisoners") and Color3.fromRGB(255, 165, 0) or
                    Color3.fromRGB(255, 255, 255) -- Default color if team is unknown
    espBox.Transparency = 0.5
    espBox.AlwaysOnTop = true
    espBox.Parent = player.Character
end

local function updateESP()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            createESP(player)
        end
    end
end

-- Auto-update ESP
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        createESP(player)
    end)
end)

-- Update ESP on existing players
updateESP()

-- Define Aim Lock functionality
getgenv().toggled = true -- true & false

getgenv().old = getgenv().old or RayCast.RayIgnoreNonCollideWithIgnoreList

if getgenv().toggled then
    RayCast.RayIgnoreNonCollideWithIgnoreList = function(...)
        local nearestDistance, nearestEnemy = 600, nil
        for _, v in pairs(Players:GetPlayers()) do
            if v.Team ~= LocalPlayer.Team and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                local distance = (v.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                if distance < nearestDistance then
                    nearestDistance, nearestEnemy = distance, v
                end
            end
        end
        local arg = {getgenv().old(...)}
        if (tostring(getfenv(2).script) == "BulletEmitter" or tostring(getfenv(2).script) == "Taser") and nearestEnemy then
            arg[1] = nearestEnemy.Character.HumanoidRootPart
            arg[2] = nearestEnemy.Character.HumanoidRootPart.Position
        end
        return unpack(arg)
    end
else
    RayCast.RayIgnoreNonCollideWithIgnoreList = getgenv().old
end

-- Load external script
loadstring(game:HttpGet("https://raw.githubusercontent.com/RegularVynixu/Vynixius/main/Jailbreak/Jailbreak"))()
