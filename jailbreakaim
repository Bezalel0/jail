-- Aimbot Script
getgenv().toggled = true -- Set to true or false to enable/disable aimbot

getgenv().old = getgenv().old or require(game:GetService("ReplicatedStorage").Module.RayCast).RayIgnoreNonCollideWithIgnoreList

if getgenv().toggled then
    require(game:GetService("ReplicatedStorage").Module.RayCast).RayIgnoreNonCollideWithIgnoreList = function(...)
        local nearestDistance, nearestEnemy = 600, nil
        for i, v in pairs(game:GetService("Players"):GetPlayers()) do
            if v.Team ~= game:GetService("Players").LocalPlayer.Team and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                if (v.Character.HumanoidRootPart.Position - game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.Position).Magnitude < nearestDistance then
                    nearestDistance, nearestEnemy = (v.Character.HumanoidRootPart.Position - game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.Position).Magnitude, v
                end
            end
        end
        local arg = {old(...)}
        if (tostring(getfenv(2).script) == "BulletEmitter" or tostring(getfenv(2).script) == "Taser") and nearestEnemy then
            arg[1] = nearestEnemy.Character.HumanoidRootPart
            arg[2] = nearestEnemy.Character.HumanoidRootPart.Position
        end
        return unpack(arg)
    end
else
    require(game:GetService("ReplicatedStorage").Module.RayCast).RayIgnoreNonCollideWithIgnoreList = getgenv().old
end

-- ESP Script with Enhanced Visibility
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Function to create an ESP Box with improved visibility
local function createESPBox(character, color)
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if hrp then
        local esp = hrp:FindFirstChild("ESP")
        if esp then
            esp:Destroy()
        end

        -- Create a BillboardGui for improved visibility
        local billboardGui = Instance.new("BillboardGui")
        billboardGui.Name = "ESP"
        billboardGui.Parent = hrp
        billboardGui.Adornee = hrp
        billboardGui.Size = UDim2.new(0, 150, 0, 150) -- Adjust size for better visibility
        billboardGui.StudsOffset = Vector3.new(0, 2, 0) -- Offset the ESP above the player
        billboardGui.AlwaysOnTop = true
        billboardGui.LightInfluence = 0 -- Ensures the ESP box is visible in all lighting conditions
        billboardGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

        local frame = Instance.new("Frame")
        frame.Parent = billboardGui
        frame.BackgroundColor3 = color
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BorderSizePixel = 0
        frame.BackgroundTransparency = 0.5 -- Semi-transparent for visibility through walls
    end
end

local function applyESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local color
            local team = player.Team.Name

            if team == "Criminals" then
                color = Color3.fromRGB(200, 0, 0) -- Darker red for criminals
            elseif team == "Cops" then
                color = Color3.fromRGB(0, 0, 200) -- Darker blue for cops
            elseif team == "Prisoners" then
                color = Color3.fromRGB(200, 100, 0) -- Darker orange for prisoners
            end

            if color then
                createESPBox(player.Character, color)
            end
        end
    end
end

-- Apply ESP and refresh every 5 seconds
applyESP()
RunService.Heartbeat:Connect(function()
    if tick() % 5 < 0.03 then
        applyESP()
    end
end)
